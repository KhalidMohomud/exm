


$("#all_authority").on("change",function(){
     console.log("lll");
     
     if($(this).is(":checked")){

        $("input[type = 'checkbox']").prop('checked',true);
     }
     else{
        $("input[type = 'checkbox']").prop('checked',false);
     }
})

$("#Academy").on("change",function(){
      console.log("vv");
      if($(this).is(":checked")){
        $("input[type = 'checkbox']").prop('checked',true);

      }else{
        $("input[type = 'checkbox']").prop('checked',false);
      }
})



fillUsers();
function fillUsers(){

    let sendingData = {
        "action" : "List_Users"
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../API/UserAuthotity.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                html += `<option value="0">Select User</option>`;
                response.forEach( res => {

                   html += `<option value="${res['id']}">${res['user_name']}</option>`;
                })

                $("#user_id").append(html);

              
            }else{
                displayMessage("error",response);
            }
           

        },
        error: function(data){

        }
    })

}

// loadData();

// function loadData() {
//     let sendingData = {
     
//         "action" : "read_User_authority"
//     };

//     $.ajax({
//         method: "POST",
//         dataType: "JSON",
       
//         url : "../API/UserAuthotity.php",
//         data: sendingData,
//         success: function (data) {
//             let status = data.status;
//             let response = data.data;
//             let html = '';

//             if (status) {
//                 let role = '';
//                 let system_links = '';
//                 let system_actions = '';

//                 response.forEach(res => {
//                     if (res['role'] !== role) {
                        
//                         if (role) {
//                             html += '</div></fieldset>';
//                         }

//                         // Start a new fieldset for each role
//                         html += `
//                             <fieldset class="authority-section">
//                                 <legend>
//                                     <input type="checkbox" id="${res['role']}" name="role_authority[]" value="${res['role']}"> ${res['role']}
//                                 </legend>
//                                 <div class="sub-section">
//                         `;

//                         role = res['role'];
//                         system_links = '';  // Reset for new role
//                     }

//                     // Create a new section for each unique system link within the role
//                     // if (res['name'] !== system_links) {
//                     //     html += `
//                     //         <legend>
//                     //             <input type="checkbox" id="${res['name']}" name="system_link[]" style="margin-left: 25px;" value="${res['link_id']}" category_id="${res['category_id']}" link_id="${res['link_id']}"> ${res['name']}
//                     //         </legend>
//                     //     `;

//                     //     system_links = res['name'];
//                     //     system_actions = '';  // Reset for new link
//                     // }

//                     // Add each action under its respective link
//                     // if (res['action_name'] !== system_actions) {
//                     //     html += `
//                     //         <label class="action-item">
//                     //             <input type="checkbox" name="system_action[]" style="margin-left: 45px;" value="${res['action_id']}" role="${res['role']}" category_id="${res['category_id']}" link_id="${res['link_id']}" action_id="${res['action_id']}"> ${res['action_name']}
//                     //         </label>
//                     //     `;

//                     //     system_actions = res['action_name'];
//                     // }
//                 });

//                 // Close the last opened fieldset
//                 html += '</div></fieldset>';

//                 // Append generated HTML to the container
//                 $(".body-authority").append(html);

//             } else {
//                 console.log("error", data.message);
//             }
//         },
//         error: function (xhr, status, error) {
//             console.log("Error:", error);
//         }
//     });
// }



loadData();
function loadData(){

    
    let sendingData = {
        "action" : "read_User_authority"
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
      
        url : "../API/UserAuthotity.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let role = '';
            let system_links= '';
            let system_actions = '';

            if(status){

                response.forEach( res => {

                  
                    for(let r in res){

                      if(res['role'] !== role){


                        html += `
                            </fieldset>
                            </div></div>

                            <div class="col-sm-4">
                                    <fieldset class="authority-border">
                                    
                                    <legend class="authority-border">
                                        
                                    <input type="checkbox" id="" name="role_authority[]" value="${res['role']}">
                                        
                                       ${res['role']}
                                    
                                    </legend>
                          
                        
                        `;

                        role = res['role'];
     

                      }


                      if(res['name'] !== system_links){

                            html += `

                                <div class="control-group>
                                <label class="control-label input-label">

                                <input type="checkbox" name="system_link[]" style="margin-left:25px !important;"  role="${res['role']}"  id="" value="${res['link_id']}" category_id="${res['category_id']}" link_id="${res['link_id']}">
                                    ${res['name']}
                                
                                </label>
                            
                            ` ;


                            system_links = res['name'];

                      }


                      if(res['action_name'] !== system_actions){

                        html += `

                            <div class="system_action">
                            
                            <label class="control-label input-label">

                            <input type="checkbox" name="system_action[]" style="margin-left:45px !important;"  role="${res['role']}"  id="" value="${res['action_id']}" category_id="${res['category_id']}" link_id="${res['link_id']}" action_id="${res['action_id']}">
                                ${res['action_name']}
                            
                            </label>
                            
                            </div>
                        
                        `;

                        system_actions = res['action_name'];

                      } 


                          
                    }

                    

                   

                })

               
                $(".body-authority").append(html);

                

            }else{
                console.log("error",response);
            }
           

        },
        error: function(data){

        }
    })

}




// loadData();

// function loadData(){

    
//     let sendingData = {
//         "action" : "read_User_authority"
//     }

//     $.ajax( {
//         method: "POST",
//         dataType: "JSON",
       
//         url : "../API/UserAuthotity.php",
//         data : sendingData,
//         success: function(data){

//             let status = data.status;
//             let response = data.data;
//             let html = '';
//             let role = '';
//             let system_links= '';
//             let system_actions = '';

//             if(status){

//                 response.forEach( res => {

                  
//                     for(let r in res){

//                       if(res['role'] !== role){

//               console.log(res,role);
//                         html += `
//                          <legend>  </legend>
//                           <fieldset class="Academy-main">
//                             <legend>
//                                 <input type="checkbox" id="Academy" name="Academy">  Academy
//                              </legend>

                             
                          

                           
                                
                        
                        
//                         `;

//                         role = res['role'];


//                       }


//                       if(res['name'] !== system_links){

//                             html += `

                                
//                                   <legend>
//                                 <input type="checkbox" id="Academy" name="Academy">  Academy
//                              </legend>
                            
//                             ` ;


//                             system_links = res['name'];

//                       }


//                     //   if(res['action_name'] !== system_actions){

//                     //     html += `

//                     //         <div class="system_action">
                            
//                     //         <label class="control-label input-label">

//                     //         <input type="checkbox" name="system_action[]" style="margin-left:45px !important;"  role="${res['role']}"  id="" value="${res['action_id']}" category_id="${res['category_id']}" link_id="${res['link_id']}" action_id="${res['action_id']}">
//                     //             ${res['action_name']}
                            
//                     //         </label>
                            
//                     //         </div>
                        
//                     //     `;

//                     //     system_actions = res['action_name'];

//                     //   } 


                          
//                     }

                    

                   

//                 })

//                 $(".body-authority").append(html);

                

//             }else{
//                 console.log("error",response);
//             }
           

//         },
//         error: function(data){
//             console.log("error",data);

//         }
//     })

// }






// loadData();

// function loadData() {
//     let sendingData = {
//         "action": "read_User_authority"
//     };

//     $.ajax({
//         method: "POST",
//         dataType: "JSON",
 
//         url : "../API/UserAuthotity.php",
//         data: sendingData,
//         success: function (data) {
//             let status = data.status;
//             let response = data.data;

//             if (status) {
//                 let authorityArea = $("#authorityArea");
//                 authorityArea.empty();  // Clear previous content

//                 let html = '';
//                 let role = '';  // Track current role
//                 let system_links = '';  // Track current system links
//                 let system_actions = '';  // Track current system actions

//                 response.forEach(res => {
//                     // Check if the role has changed
//                     if (res['role'] !== role) {
//                         // Add the HTML structure for the new role
//                         html += `
//                             <div class="body-authority">
//                                 <fieldset class="${res['role']}-main">
//                                     <legend>
//                                         <input type="checkbox" id="${res['role']}" name="${res['role']}"> ${res['role']}
//                                     </legend>
//                                     <div class="secons_le">
//                         `;

//                         role = res['role'];  // Update the role
//                         system_links = '';   // Reset system links
//                     }

//                     // Check if the system link has changed
//                     if (res['name'] !== system_links) {
//                         html += `
//                             <legend>
//                                 <input type="checkbox" id="${res['name']}" name="${res['name']}"> ${res['name']}
//                             </legend>
//                         `;
//                         system_links = res['name'];  // Update system links
//                     }

//                     // Add system action for each action_name
//                     html += `
//                         <label>
//                             <input type="checkbox" id="${res['action_name']}" name="${res['action_name']}"> ${res['action_name']}
//                         </label>
//                     `;

//                     // Close each role's fieldset and body-authority div at the end
//                     if (res === response[response.length - 1] || res['role'] !== response[response.indexOf(res) + 1]?.['role']) {
//                         html += `
//                                     </div>
//                                 </fieldset>
//                             </div>
//                         `;
//                     }
//                 });

//                 // Append the constructed HTML to authorityArea
//                 authorityArea.append(html);
//                 $(".body-authority").append(html);
//             } else {
//                 console.log("error", response);
//             }
//         },
//         error: function (data) {
//             console.error("Error loading data", data);
//         }
//     });
// }

// loadData();
// function loadData() {
//     let sendingData = {
//         "action": "read_User_authority"
//     };

//     $.ajax({
//         method: "POST",
//         dataType: "JSON",
     
//         url : "../API/UserAuthotity.php",
//         data: sendingData,
//         success: function (data) {
//             let status = data.status;
//             let response = data.data;

//             if (status) {
//                 let authorityArea = $("#authorityArea");
//                 authorityArea.empty();  // Clear previous content

//                 let html = '';
//                 let role = '';  // Track the current role
//                 let system_links = '';  // Track system links
//                 let system_actions = '';  // Track system actions

//                 response.forEach(res => {
//                     // Add new role section if the role changes
//                     if (res['role'] !== role) {
//                         // Append closing tags for the previous role if it exists
//                         if (html !== '') {
//                             html += `</div></fieldset>`;
//                         }

//                         // Insert the new role HTML structure
//                         html += `
//                         <div class="body-authority">
//                             <fieldset class="${res['role']}-main">
//                                 <legend>
//                                     <input type="checkbox" id="${res['role']}" name="${res['role']}"> ${res['role']}
//                                 </legend>
//                                 <div class="secons_le">
//                                     <legend>
//                                         <input type="checkbox" id="${res['dashboard'] || 'dashboard1'}" name="dashboard"> Dashboard
//                                     </legend>
//                                     <legend>
//                                         <input type="checkbox" id="Registration" name="Registration"> Registration
//                                     </legend>
//                                     <label>
//                                         <input type="checkbox" id="Student" name="Student"> Student
//                                     </label>
//                                     <label>
//                                         <input type="checkbox" id="teachers" name="teachers"> Teachers
//                                     </label>
//                                     <legend>
//                                         <input type="checkbox" id="attendecs" name="attendecs"> Attendecs
//                                     </legend>
//                                     <label>
//                                         <input type="checkbox" id="Student" name="Student"> Student
//                                     </label>
//                                     <label>
//                                         <input type="checkbox" id="teachers" name="teachers"> Teachers
//                                     </label>
//                                 </div>
//                             </fieldset>
//                         `;

//                         // Update the role for the next loop
//                         role = res['role'];
//                         system_links = '';  // Reset system links for the new role
//                     }
//                 });

//                 // Append the last role HTML to authorityArea
//                 authorityArea.append(html);
//                 $(".body-authority").append(html);
//                 console.log(html);
//             } else {
//                 console.log("error", response);
//             }
//         },
//         error: function (data) {
//             console.error("Error loading data", data);
//         }
//     });
// }
// loadData() ;
// function loadData() {
//     let sendingData = {
//         "action": "read_User_authority"
//     };

//     $.ajax({
//         method: "POST",
//         dataType: "JSON",
//         url: "../API/UserAuthotity.php",
//         data: sendingData,
//         success: function (data) {
//             let status = data.status;
//             let response = data.data;

//             if (status) {
//                 let authorityArea = $("#authorityArea");
//                 authorityArea.empty();  // Clear previous content

//                 let html = '';
//                 let currentRole = '';   // Track the current role
//                 let currentSystemLink = '';  // Track the current system link within each role

//                 response.forEach((res, index) => {
//                     // Check if the role has changed
//                     if (res['role'] !== currentRole) {
//                         // Close the previous fieldset and div if not the first iteration
//                         if (currentRole !== '') {
//                             html += `</div></fieldset></div>`;
//                         }

//                         // Start a new section for the new role
//                         html += `
//                             <div class="body-authority">
//                                 <fieldset class="${res['role']}-main">
//                                     <legend>
//                                         <input type="checkbox" id="${res['role']}" name="${res['role']}"> ${res['role']}
//                                     </legend>
//                                     <div class="secons_le">
//                         `;

//                         // Update role and reset system link tracking
//                         currentRole = res['role'];
//                         currentSystemLink = '';
//                     }

//                     // Check if the system link (main category) has changed
//                     if (res['name'] !== currentSystemLink) {
//                         html += `
//                             <legend>
//                                 <input type="checkbox" id="${res['name']}" name="${res['name']}"> ${res['name']}
//                             </legend>
//                         `;
//                         currentSystemLink = res['name'];  // Update system link
//                     }

//                     // Add each system action (subcategory) under the current system link
//                     html += `
//                         <label>
//                             <input type="checkbox" id="${res['action_name']}" name="${res['action_name']}"> ${res['action_name']}
//                         </label>
//                     `;

//                     // Close the last role's fieldset and div at the end of the loop
//                     if (index === response.length - 1) {
//                         html += `</div></fieldset></div>`;
//                     }
//                 });

//                 // Append the constructed HTML to authorityArea
//                 authorityArea.append(html);
//                 $(".body-authority").append(html);
//             } else {
//                 console.log("error", response);
//             }
//         },
//         error: function (data) {
//             console.error("Error loading data", data);
//         }
//     });
// }

