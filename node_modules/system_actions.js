loadData();

btnAction = "Insert";
fillLinks();

$("#openModalBtn").on("click",function(){
    $(".modal-systm_actions").show();
    console.log(56789);
});

$("#close_btn").click(function(){
    $(".modal-systm_actions").hide();
     console.log(5678);

})


$("#Xbtn").click(function(){
    $(".modal-systm_actions").hide();
     //console.log(5678);

})


$("#modal-systm_actions").on("submit",function(event) {

    event.preventDefault();

    let name = $("#name").val();
    let link_id = $("#link_id").val();
    let system_action = $("#system_action").val();
    let id = $("#update_id").val();

    let sendingData = {}

    if(btnAction == "Insert"){
        sendingData = {
            "name" : name,
            "link_id" : link_id,
            "system_action" : system_action,
            "action" : "register_system_action"
            
        }
    
    }else{
          sendingData = {
            "id" : id,
            "name" : name,
            "link_id" : link_id,
            "system_action" : system_action,
            "action" : "update_system_action"
            
        }
    
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../api/system_actions.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;

            if(status){

                console.log("success",response);
                btnAction = "Insert";
                loadData();
            }else{
                console.log("error",response);
            }
           

        },
        error: function(data){
            console.log("error",data.responseText);
        }
    })

})


// function loadData(){

//     $("#system_actions_table tr").html('');

//     let sendingData = {
//         "action" : "read_all_system_action"
//     }

//     $.ajax( {
//         method: "POST",
//         dataType: "JSON",
//         url : "../API/system_actions.php",
//         data : sendingData,
//         success: function(data){

//             let status = data.status;
//             let response = data.data;
//             let html = '';
//             let tr = '';
//             let th = '';

//             if(status){

//                 response.forEach( res => {

//                     th = "<tr>";
//                     for(let i in res){
//                         th += `<th>${i}</th>`;
//                     }

//                     th +="<th>Action</th></tr>";

//                     tr += "<tr>";
//                     for(let r in res){

                      
//                             tr += `<td>${res[r]}</td>`;
//                         }

                    

//                     tr += `<td> <a class="btn btn-info update_info" update_id=${res['id']}><i class="fas fa-edit" style="color:#fff;"></i></a>&nbsp;&nbsp;<a class="btn btn-danger delete_info" delete_id=${res['id']}><i class="fas fa-trash" style="color:#fff;"></i></a> </td>`;
//                     tr += "</tr>";

//                 })

//                 // $("#system_actions_table thead").append(th);
//                 $("#system_actions_table tbody").append(tr);

//             }else{
//                 console.log("error",response);
//             }
           

//         },
//         error: function(data){

//         }
//     })

// }

function loadData(){

    $("#system_actions_table tbody").html('');

    let sendingData = {
        "action" : "read_all_system_action"
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
       
        url : "../API/system_actions.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                response.forEach( itm => {

                    tr += "<tr>";
                    for(let i in itm){

                      
                            tr += `<td>${itm[i]}</td>`;
                        }

                    

                        tr += `<td > <buttonclass="btn_upda"> <a class="updete_cl"update_id=${itm['id']}><span class="material-symbols-outlined" style ="color:#fff;background-color:var(--base-clr); font-size: xx-large;  font-weight: bold; border-radius: 5px; ">edit
                        </span></a></button> &nbsp;&nbsp;<a class="delete_cl" delete_id=${itm['id']}><span class="material-symbols-outlined" style ="color:#fff;background-color:red;font-size: xx-large;  font-weight: bold; border-radius: 5px;">delete
                        </span></a> </td>` 
                       
                        tr += '</tr>'  

                })

                $("#system_actions_table tbody").append(tr);

            }else{
               // alert("error",response);
            }
           

        },
        error: function(data){

        }
    })

}


function fillLinks(){

   

    let sendingData = {
        "action" : "read_all_db_links"
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../API/system_links.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                
                response.forEach( res => {

                   html += `<option value="${res['id']}">${res['name']}</option>`;
                })

                $("#link_id").append(html);

              
            }else{
                console.log("error",response);
            }
           

        },
        error: function(data){

        }
    })

}

function fetchlinkInfo(id){

    let sendingData = {
        "action" : "get_action_info",
        "id": id
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
       
        url : "../API/system_actions.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                    btnAction = "Update";
                   $("#update_id").val(response['id']);
                   $("#name").val(response['name']);
                   $("#link_id").val(response['link_id']);
                   $("#system_action").val(response['action']);

                   $("#modal-systm_actions").show();

            }else{
                console.log("error",response);
            }
           

        },
        error: function(data){

        }
    })



}


function DeletelinkInfo(id){

    let sendingData = {
        "action" : "delete_action_info",
        "id": id
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../API/system_actions.php",
        
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                alert("Good job!", response, "success");
                loadData();

            }else{
                alert(response);
            }
           

        },
        error: function(data){

        }
    })



}



$("#system_actions_table tbody").on("click", "a.delete_cl",function(){

    let id = $(this).attr("delete_id");
    console.log(id);
   if(confirm("are you sure to delete")){
       DeletelinkInfo(id);
   }
   
})

$("#system_actions_table tbody").on("click", "a.updete_cl",function(){
    
    let id = $(this).attr("update_id");
    fetchlinkInfo(id);
    console.log(id);
  
   


    

})
