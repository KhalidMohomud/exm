
btnAction = "Insert";

$("#openModalBtn").on("click",function(){
    $(".modal-class").show();
    console.log(56789);
});

$("#closebtn").click(function(){
    $(".modal-class").hide();
    
})


$("#Xbtn").click(function(){
    $(".modal-class").hide();
     //console.log(5678);

})


// $("#modal-class").on("submit",function(event) {
//     event.preventDefault();
//     let id = $("#update_id").val();
//     let names = $("#name").val();
//      let course_id = $("#course_id").val();
   
   

//     let sendingData = {}

//     if(btnAction == "Insert"){
//         sendingData = {
//             "name" : names,
//              "course_id" :course_id,
//             "action" : "register_class"
//         }
//     }
//     else{
//           sendingData = {
//             "class_id": id,
//             "name" : names,
//             "course_id" : course_id,
//             "action" : "Update_class"
            
//         }
    
//     }

    
  
//     $.ajax( {
//         method: "POST",
//         dataType: "JSON",
//         url : "../APi/class.php",
//         data : sendingData,
//         success: function(data){

//             let status = data.status;
//             let response = data.data;

//             if(status.data == "sucess"){

//                 Swal.fire({
//                     title: response,
//                     icon: "success"
//                   });
              

//                 console.log("success",response.data);
//                 btnAction = "Insert";
//                 loadData();
//             }
            
       
            
//             else{
//                 alert("error",response);
//             }
           

//         },
//         error: function(data){
//           console.log("error",data);
//         }
//     })

// })



$("#modal-class").on("submit",function(event) {

    event.preventDefault();
    let id = $("#updateid").val();
    let class_name = $("#class_name").val();

    let course_id = $("#course_id").val();
   

    let sendingData = {}

    if(btnAction == "Insert"){
        sendingData = {
          
            "class_name" : class_name,
            "course_id" :course_id,
            "action" : "register_class"
            
        }
    
    }else{
          sendingData = {
           
            "class_id" :id,
            "class_name" : class_name,
            "course_id" :course_id,
            "action" : "Update_class"
            
        }
    
    }

    
  
    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../APi/class.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;

            if(status){

                Swal.fire({
                    title: response,
                    icon: "success"
                  });

                  setTimeout(() => {
                   
                    $(".modal-depart").show();
                  }, 1000);

                console.log("success",response);
                btnAction = "Insert";
                loadData();
            }else{
                alert("error",response);
            }
           

        },
        error: function(data){
          console.log("error",data);
        }
    })

})













Department_name();

function Department_name(){

   

    let sendingData = {
        "action" : "class_read"
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../APi/course.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                
                response.forEach( res => {

                   html += `<option value="${res['course_id']}">${res['course_id']}</option>`;
                })

                $("#course_id").append(html);

              
            }else{
                alert("error",response);
            }
           

        },
        error: function(data){

        }
    })

}



loadData();
function loadData(){

    $("#class_Table tbody").html('');

    let sendingData = {
        "action" : "class_read"
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../APi/class.php",
       
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                response.forEach( itm => {

                    tr += "<tr>";
                    for(let i in itm){

                      
                            tr += `<td>${itm[i]}</td>`;
                        }

                    

                        tr += `<td > <buttonclass="btn_upda"> <a class="updete_cl"update_id=${itm['class_id']}><span class="material-symbols-outlined" style ="color:#fff;background-color:blue; font-size: xx-large;  font-weight: bold; border-radius: 5px; ">edit
                        </span></a></button> &nbsp;&nbsp;<a class="delete_cl" delete_id=${itm['class_id']}><span class="material-symbols-outlined" style ="color:#fff;background-color:red;font-size: xx-large;  font-weight: bold; border-radius: 5px;">delete
                        </span></a> </td>` 
                       
                        tr += '</tr>'  

                })

                $("#class_Table tbody").append(tr);

            }else{
                console.log("error",response);
            }
           

        },
        error: function(data){
            console.log(data);

        }
    })

}







function fetch_classInfo (id){

    let sendingData = {
      "action" : "class_fetch",
        "class_id": id
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../APi/class.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){
         console.log(status);
               
         btnAction = "Update";
                   $("#class_name").val(response['class_name']);
                   $("#course_id").val(response['course_id']);

                   $(".modal-class").show();
                  
            }else{
                alet("error",response);
            }
           

        },
        error: function(data){

        }
    })



}


function Delete_class(id){

    let sendingData = {
        "action" : "delete_class_info",
        "class_id": id
    }

    $.ajax( {
        method: "POST",
        dataType: "JSON",
        url : "../APi/class.php",
        data : sendingData,
        success: function(data){

            let status = data.status;
            let response = data.data;
            let html = '';
            let tr = '';

            if(status){

                  Swal.fire({
                    title: response,
                    icon: "success",
                    Text: status,
                  });
                loadData();

            }else if(status){
          
                Swal.fire({
                    title: response.message,
                    icon: "error",
                    Text: status,
                  });
            }
           

        },
        error: function(message){
          
            Swal.fire({
                title: response.message,
                icon: "error",
                
              });

        }
    })



}



$("#class_Table  tbody").on("click", "a.delete_cl",function(){

    let id = $(this).attr("delete_id");
    console.log(id);
   if(confirm("are you sure to delete")){
    Delete_class(id);
   }
   
})

$("#class_Table tbody").on("click", "a.updete_cl",function(){
    
    let id = $(this).attr("update_id");
  
    console.log(id);
    fetch_classInfo(id);
   
   
   


    

})
