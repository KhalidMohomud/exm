
let btnaction = "insert"

$("#openModalBtn").click(function(){
    $(".modal-user").show();
     //console.log(5678);

})
$("#Xbtn").click(function(){
    $(".modal-user").hide();
     //console.log(5678);

})
$("#closebtn").click(function(){
    $(".modal-user").hide();
     //console.log(5678);

})







let fileImage = document.querySelector("#image");
let showInput = document.querySelector("#show");

 const reader = new FileReader();



fileImage.addEventListener("change",(e)=>{

  
    const seletecedfill = e.target.files[0];
    reader.readAsDataURL(seletecedfill);


})


reader.onload = e => {
    showInput.src = e.target.result;
  }

  
     $("#Users_from").submit(function (e) { 
        e.preventDefault();

        let fromdate  =  new FormData($(this)[0]);
        fromdate.append("image",$("input[type=file]")[0].files[0]);


        if (btnaction === "insert") {
            fromdate.append("action", "Isert_Users");
        } else if (btnaction === "Update") {
            form_data.append("action", "update_user");
        }
              
        $.ajax({
            type: "post",
            url: "../API/users.php",
            data: fromdate,
            dataType: "json",
            processData: false,
            contentType: false,
            success: function (data) {
                
                let status = data.status;
                let response = data.data;
                Swal.fire({
                    title: "Good for you Rigister!",
                    icon: "success"
                  });
                $("#Users_from")[0].reset();  
                load();
                
                btnaction = "Insert";

                
            }, error: function (data){
                console.log("error",data)
            }
        });
          
        
     });
















  load();
  function load(){

    let emty = $("#User_Table tbody").html("");

    let sendData = {
        action :"UserList",
    };

    $.ajax({
        type: "POST",
        url: "../API/users.php",
        data: sendData,
        dataType: "json",
        success: function (message) {
            
            let status = message.status;
            let response = message.message;
            console.log(response);
          
         
           
            if(status){   
                

                let html = '';
                let tr = '';
                
                
                response.forEach( itm =>{
                    tr += '<tr>';
                    for(let i in itm){
                        // console.log(i);
                        // console.log(itm);

                        if(i == "image"){
                            tr  += `<td style = "ustify-content: center;
                             " ><img style ="width:15%;
                      height:15%;border-radius: 50%; object-fit:cover;
                       "src="../Upload/${itm[i]}"></td>`

                        }else
                        {
                            tr += `<td>${itm[i]}</td>`;
                           
                        }

                    
                       
                    
                    }
                         
                    tr += `<td > <buttonclass="btn_upda"> <a class="updete_cl"update_id=${itm['id']}><span class="material-symbols-outlined" style ="color:#fff;background-color:var(--base-clr); font-size: xx-large;  font-weight: bold; border-radius: 5px; ">edit
                    </span></a></button> &nbsp;&nbsp;<a class="delete_cl" delete_id=${itm['id']}><span class="material-symbols-outlined" style ="color:#fff;background-color:red;font-size: xx-large;  font-weight: bold; border-radius: 5px;">delete
                    </span></a> </td>` 
                   
                    tr += '</tr>'  
                   
                })  
                $("#User_Table tbody").append(tr);
                       
            }else{
                console.error('Status is false');
            }
            
        },  error: function (data) {
            console.error(data);
        }
    });
}




function User_info_modal(id){

    let sendData = {
     "action" : "readforms",
      "id": id,
      
    }


    $.ajax({
     type: "POST",
     url: "../API/users.php",
     data: sendData,
     dataType: "json",
     success: function (data) {

         let status = data.status;
         let response = data.data;
       

         if(status){
         
               
              $('#user_name').val(response[0].user_name);
             // $('#password').val(response[0].password);
               $('#Type').val(response[0].type);
              $('#show').attr('src',`../Upload/${response[0].Image}`);
              $(".modal-user").show();
              btnaction = "update"; 
              
           
              
         
                  
             //   console.log(response);

             

         }else{
             console.log("errr",status);
         }
         
     },error: function(data){
         console.log("eror",data);
     }
    });
}



function UserDelete(id) {

    let sendData = {
      "id": id,
     action: "UserDelete",
    };
    $.ajax({
     type: "POST",
     url: "../API/users.php",
     data: sendData,
     dataType: "json",
     success: function (data) {

         let status = data.status;
         let response = data.data;

         if(status){
            
             Swal.fire({
                 title: "Good for you Delete!",
                 icon: "success"
               });

             load();
           
       
         }
         
     }, error: function (data){
         console.log(data);

     }
    });
}





$("#User_Table tbody").on("click", "a.delete_cl",function(){

    let id = $(this).attr("delete_id");
    console.log(id);
   if(confirm("are you sure to delete")){
       UserDelete(id);
   }
   
})

$("#User_Table tbody").on("click", "a.updete_cl",function(){
    
    let id = $(this).attr("update_id");
    User_info_modal(id);
    console.log(id);
  
   


    

})
















